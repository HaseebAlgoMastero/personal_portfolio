import { Footer } from '~/components/footer';
import { DecoderText } from '~/components/decoder-text';
import { Heading } from '~/components/heading';
import { Link } from '~/components/link';
import { Text } from '~/components/text';
import AnoAI from '~/components/ui/animated-shader-background';
import { CursorFollower } from '~/components/ui/cursor-follower';
import { useEffect, useRef, useState } from 'react';
import { baseMeta } from '~/utils/meta';

export const meta = () => {
  return baseMeta({
    title: 'Professional Experience',
    description: 'A curated look at my professional journey and impactful roles.',
  });
};

const experiences = [
  {
    range: 'June 2025 - Present',
    title: 'AI Engineer',
    company: 'Cybersoft North America Inc.',
    brandColor: '#25d4ff',
    intro:
      'Building intelligent automation across AI + IoT stacks, shipping resilient, real-time systems with modern LLM tooling.',
    bullets: [
      'Integrated AI with IoT using ESP32S3 controllers and Raspberry Pi Pico 2 for intelligent automation systems',
      'Worked with Simpli-Fi Automation and NASA Products, developing real-time AI solutions for critical applications',
      'Implemented Generative AI applications using LangChain, Standard RAG, Hybrid RAG, and Graph RAG frameworks',
      'Worked with multiple Open Source LLMs including OpenAI, Cohere, Mistral, Anthropic, and Gemini',
      'Developed Agentic AI systems using OpenAI Agentic SDK, CrewAI, LangGraph, and MCP server integration',
      'Collaborated in cross-functional teams with strong problem-solving, communication, and client handling skills',
    ],
    tags: ['AI-IoT', 'XIAO_ESp32S3', 'Python', 'Generative AI', 'Agentic AI', 'Raspberry Pi Pico 2', 'eNose'],
  },
  {
    range: 'May 2020 - Jun 2021',
    title: 'Product Engineer',
    company: 'ProfileBud',
    brandColor: '#48e2c2',
    intro: 'Led frontend development, created payment and admin portals, developed GoLang server.',
    bullets: [
      'Led the frontend development for the company as one of the founding members.',
      'Learned and made responsive websites, blogs via Gatsby, payment and admin portals following Agile principles.',
      'Developed a GoLang server to handle 20M+ users data with 1K+ req/s.',
    ],
    tags: ['React', 'Rails', 'GoLang', 'Gatsby', 'Javascript'],
  },
];

const resumeHref = '/static/Haseeb_Iqbal_CV.pdf';

const ExperienceCard = ({ experience, index, total }) => {
  const ref = useRef(null);
  const [isVisible, setIsVisible] = useState(false);
  const isEven = index % 2 === 0;
  const isLast = index === total - 1;
  const badgeNumber = String(index + 1).padStart(2, '0');

  useEffect(() => {
    if (typeof window === 'undefined') return;
    const node = ref.current;
    if (!node) return;
    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            setIsVisible(true);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.25 }
    );
    observer.observe(node);
    return () => observer.disconnect();
  }, []);

  return (
    <article
      ref={ref}
      style={{
        position: 'relative',
        maxWidth: 760,
        width: '100%',
        padding: 2,
        borderRadius: 36,
        marginTop: 0,
        marginBottom: isLast ? '0' : 'clamp(56px, 9vh, 88px)',
        marginLeft: isEven ? '0' : 'auto',
        marginRight: isEven ? 'auto' : '0',
        background: isEven
          ? 'linear-gradient(135deg, rgb(var(--accent) / 0.35), rgb(var(--rgbBackground) / 0.45))'
          : 'linear-gradient(135deg, rgb(var(--primary) / 0.35), rgb(var(--rgbBackground) / 0.45))',
        opacity: isVisible ? 1 : 0,
        transform: isVisible
          ? 'translate3d(0, 0, 0)'
          : isEven
          ? 'translate3d(-90px, 40px, 0)'
          : 'translate3d(90px, 40px, 0)',
        filter: isVisible ? 'blur(0)' : 'blur(14px)',
        transition:
          'opacity 0.9s cubic-bezier(0.16, 1, 0.3, 1), transform 0.9s cubic-bezier(0.16, 1, 0.3, 1), filter 0.65s ease',
        scrollMarginTop: '120px',
      }}
    >
      <div
        style={{
          borderRadius: 32,
          padding: 'clamp(48px, 5vw, 60px) clamp(28px, 4vw, 48px) clamp(36px, 4vw, 48px)',
          background:
            'linear-gradient(145deg, rgb(var(--rgbBackground)), rgb(var(--rgbBackground) / 0.85))',
          position: 'relative',
          overflow: 'hidden',
          border: '1px solid rgb(var(--rgbText) / 0.08)',
          boxShadow: '0 45px 90px -65px rgb(var(--rgbText) / 0.85)',
        }}
      >
        <div
          aria-hidden
          style={{
            position: 'absolute',
            inset: 0,
            background: isEven
              ? 'radial-gradient(circle at 10% 0%, rgb(var(--accent) / 0.35), transparent 55%)'
              : 'radial-gradient(circle at 90% 0%, rgb(var(--primary) / 0.35), transparent 55%)',
            opacity: 0.5,
            pointerEvents: 'none',
          }}
        />
        <div style={{ height: 18 }} />
        <div style={{ position: 'relative', display: 'flex', flexDirection: 'column', gap: 14 }}>
          <div
            style={{
              display: 'flex',
              flexWrap: 'wrap',
              alignItems: 'center',
              gap: 14,
              fontWeight: 700,
              fontSize: 'clamp(1.05rem, 2.6vw, 1.5rem)',
              color: 'inherit',
            }}
          >
            <span
              style={{
                fontSize: '1.05rem',
                letterSpacing: '0.35em',
                textTransform: 'uppercase',
                display: 'inline-flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '6px 18px 6px 14px',
                borderRadius: 999,
                background: 'linear-gradient(120deg, var(--accent), var(--primary))',
                color: 'rgb(var(--rgbBackground))',
                boxShadow: '0 18px 45px -25px var(--accent)',
              }}
            >
              {badgeNumber}
            </span>
            <span aria-hidden style={{ fontSize: 18, display: 'inline-flex' }}>
              â€¢
            </span>
            <span
              style={{
                fontWeight: 700,
              }}
            >
              {experience.title} Â· {experience.company}
            </span>
            <span
              style={{
                marginLeft: 'auto',
                fontSize: '0.95rem',
                fontWeight: 600,
                color: 'var(--textLight)',
              }}
            >
              {experience.range}
            </span>
          </div>
          <Text as="p" size="m" style={{ margin: 0, opacity: 0.9 }}>
            {experience.intro}
          </Text>
          <ul
            style={{
              margin: '6px 0 0',
              paddingLeft: 18,
              display: 'grid',
              gap: 10,
              lineHeight: 1.6,
            }}
          >
            {experience.bullets.map(point => (
              <li key={point}>
                <Text as="span" size="m">
                  {point}
                </Text>
              </li>
            ))}
          </ul>
          <div style={{ display: 'flex', flexWrap: 'wrap', gap: 12, marginTop: 8 }}>
            {experience.tags.map(tag => (
              <span
                key={tag}
                style={{
                  position: 'relative',
                  fontSize: 11,
                  letterSpacing: '0.22em',
                  textTransform: 'uppercase',
                  padding: '10px 20px 10px 18px',
                  borderRadius: 999,
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: 8,
                  color: 'rgb(var(--rgbText))',
                  boxShadow: '0 20px 40px -30px rgb(var(--rgbText) / 0.85)',
                  background:
                    'linear-gradient(135deg, rgb(var(--rgbBackground) / 0.95), rgb(var(--rgbBackground) / 0.6))',
                  border: '1px solid rgb(var(--rgbText) / 0.25)',
                  overflow: 'hidden',
                }}
              >
                <span
                  style={{
                    position: 'relative',
                    width: 7,
                    height: 7,
                    borderRadius: '50%',
                    background: 'linear-gradient(180deg, var(--accent), var(--primary))',
                    boxShadow: '0 0 12px rgb(var(--accent) / 0.7)',
                  }}
                />
                {tag}
              </span>
            ))}
          </div>
        </div>
      </div>
    </article>
  );
};

export default function ProfessionalExperienceRoute() {
  return (
    <>
      <CursorFollower />
      <section aria-labelledby="experience-heading">
        <div
          style={{
            position: 'relative',
            width: '100%',
            height: '100vh',
            minHeight: 540,
            textAlign: 'center',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden',
          }}
        >
          <AnoAI />
          <div
            style={{
              position: 'absolute',
              inset: 0,
              background: 'linear-gradient(180deg, rgb(var(--rgbBackground) / 0.4), transparent 50%, rgb(var(--rgbBackground)))',
            }}
          />
          <div style={{ position: 'relative', zIndex: 2, padding: '0 24px' }}>
            <style
              dangerouslySetInnerHTML={{
                __html: `
                  @keyframes underlineShimmer { from { background-position: 0% 50%; } to { background-position: 100% 50%; } }
                  @keyframes caretBlink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0; } }
                `,
              }}
            />
            <h1
              id="experience-heading"
              style={{
                margin: 0,
                fontWeight: 800,
                letterSpacing: '0.04em',
                fontSize: 'clamp(2.2rem, 6vw, 3.5rem)',
                fontFamily:
                  'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',
                display: 'inline-flex',
                alignItems: 'center',
                gap: 12,
              }}
            >
              <span
                aria-hidden
                style={{
                  display: 'inline-block',
                  width: 8,
                  height: '1.25em',
                  borderRadius: 6,
                  marginRight: 6,
                  background: 'linear-gradient(180deg, var(--accent), var(--primary))',
                  boxShadow: '0 0 18px var(--accent), 0 0 26px var(--primary)',
                }}
              />
              <DecoderText text="PROFESSIONAL EXPERIENCE" start delay={120} springConfig={{ stiffness: 10, damping: 6 }} />
              <span
                aria-hidden
                style={{
                  width: 12,
                  height: '1.15em',
                  borderLeft: '3px solid currentColor',
                  animation: 'caretBlink 1s steps(2, start) infinite',
                }}
              />
            </h1>
            <div style={{ position: 'relative', height: 12, marginTop: 14 }}>
              <div
                style={{
                  position: 'absolute',
                  left: '20%',
                  right: '20%',
                  top: 6,
                  height: 2,
                  background: 'rgb(var(--rgbText))',
                  borderRadius: 9999,
                  opacity: 0.9,
                }}
              />
              <div
                style={{
                  position: 'absolute',
                  left: '25%',
                  right: '25%',
                  top: 5,
                  height: 3,
                  background: 'linear-gradient(90deg, var(--accent), var(--primary), var(--accent))',
                  backgroundSize: '200% 100%',
                  animation: 'underlineShimmer 2.5s linear infinite',
                  borderRadius: 9999,
                }}
              />
            </div>
          </div>
        </div>
      </section>
      <section
        aria-label="Professional experience cards"
        style={{
          position: 'relative',
          padding: 'clamp(48px, 12vh, 140px) clamp(20px, 8vw, 150px) clamp(32px, 8vh, 120px)',
          overflow: 'hidden',
        }}
      >
        <div
          aria-hidden
          style={{
            position: 'absolute',
            inset: 0,
            background: 'radial-gradient(circle at top, rgb(var(--rgbText) / 0.08), transparent 65%)',
            filter: 'blur(60px)',
          }}
        />
        <div style={{ position: 'relative', zIndex: 1, maxWidth: 900, margin: '0 auto' }}>
          <div style={{ textAlign: 'center', marginBottom: 'clamp(32px, 6vh, 56px)' }}>
            <Heading level={2} align="center">
              Changelog from my journey
            </Heading>
            <Text as="p" size="l" align="center" style={{ opacity: 0.85, marginTop: 12 }}>
              I have been working on Kay.ai for the past 1.5 years. Here is a timeline of my journey.
            </Text>
          </div>
          {experiences.map((experience, index) => (
            <ExperienceCard
              key={`${experience.title}-${experience.company}`}
              experience={experience}
              index={index}
              total={experiences.length}
            />
          ))}
          <div style={{ display: 'flex', justifyContent: 'center', marginTop: 'clamp(40px, 7vh, 60px)' }}>
            <Link href={resumeHref} style={{ fontWeight: 600, display: 'inline-flex', alignItems: 'center', gap: 8 }}>
              View Full Resume
              <span aria-hidden style={{ fontSize: 18 }}>
                â†—
              </span>
            </Link>
          </div>
        </div>
      </section>
      <Footer />
    </>
  );
}
